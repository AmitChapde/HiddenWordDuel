generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

enum MatchStatus {
  ongoing
  completed
}


model Player {
  id String @id @default(uuid())
  username  String  @unique
  createdAt DateTime  @default(now())

  // relations
  matches1  Match[] @relation("player1")
  matches2  Match[] @relation("player2")
  guesses Guess[]

  wonRounds Round[] @relation("RoundWinner")
}



model Match {
  id  String  @id @default(uuid())
  player1Id String
  player2Id String

  score1  Int @default(0)
  score2  Int @default(0)

  status  MatchStatus @default(ongoing)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // relations
  player1 Player @relation("player1",fields:[player1Id],references:[id])
  player2 Player @relation("player2",fields:[player2Id],references:[id])

  rounds Round[]
}

model Round {
  id            String   @id @default(uuid())
  matchId       String
  word          String
  revealedTiles Boolean[]
  winnerId      String?   
  roundNumber   Int

  createdAt DateTime @default(now())
  endedAt   DateTime?

  // relations
  match   Match   @relation(fields: [matchId], references: [id])
  guesses Guess[]

  winner Player? @relation("RoundWinner", fields: [winnerId], references: [id])
}

model Guess {
  id  String  @id @default(uuid())
  roundId String
  playerId  String
  guess String
  isCorrect Boolean
  createdAt DateTime @default(now())

  // relations
  round Round @relation(fields:[roundId],references:[id])
  player  Player  @relation(fields:[playerId],references:[id])

  @@index([roundId])
  @@index([playerId])
}